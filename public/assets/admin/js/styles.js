$(document).ready(function(){[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e)});openSidebarCart(),openSidebarVoucher(),change_cart(),mouse_hover_menu(),get_images_color(),applyVoucher(),applyInputVoucher(),deleteVoucher(),$("#password-register").on("input",function(){evaluatePasswordCriteria($(this).val())}),showPasswordToggle(),resetFormRegister(),fancyBox(),$(".login-btn").on("click",function(){$("#modalToggle").modal("toggle"),setTimeout(()=>{$("#modalToggle").modal("show")},500)}),toggle_login_modal(),forgot_password()});var isLoading=!1;function fancyBox(){Fancybox.bind('[data-fancybox="gallery"]',{Thumbs:{type:"classic"}})}function applyVoucher(){$(".applyVoucher").on("click",function(){let e=$(this).attr("data-code");$.ajax({url:"/apply-voucher",type:"POST",data:{voucher:e},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){200==e.status&&($(".code-voucher").text(e.data.code),$(".voucher-discount").text(e.data.voucher),$(".alert-message-voucher").text(""),closeNavVoucher(),$(".input_apply_btn").addClass("d-none"),$(".voucher-apply").removeClass("d-none"))}})})}function deleteVoucher(){$(".delete-voucher").on("click",function(){let e=$(this).attr("data-code");$.ajax({url:"/delete-voucher",type:"POST",data:{voucher:e},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){200==e.status&&($(".input_apply_btn").removeClass("d-none"),$(".voucher-apply").addClass("d-none"))}})})}function toggle_login_modal(){$("#modalToggle").on("hidden.bs.modal",function(e){$(".modal_login").removeClass("d-none"),$(".modal_register").addClass("d-none"),$(".model-forgot-password").addClass("d-none"),$(".modal-forgot-password").addClass("d-none"),$(".step-1").addClass("d-none"),$(".step-2").addClass("d-none"),$(".step-3").addClass("d-none"),$(".forgot-step-1").addClass("d-none"),$(".forgot-step-2").addClass("d-none"),$(".forgot-step-3").addClass("d-none"),$(".forgot-step-4").addClass("d-none");document.querySelector(".modal-content, .otpCode").querySelectorAll('input[type="text"], input[type="password"]').forEach(e=>{e.value=""})})}function get_images_color(){isLoading||(isLoading=!0,$(document).on("click",".color-item-outside",function(){var e=$(this).data("color-id"),t=$(this).data("id-product"),o=$(this).data("default-color");$(".left").html('<span class="loader m-auto pt-3"></span>'),$.ajax({url:"/api/products-color",type:"GET",data:{colorId:e,productId:t,defaultColor:o},success:function(e){setTimeout(()=>{if(e&&e.html){$(".size-available").html(e.html_size),$(".tooltip").remove(),$(".wrapper-button-add-cart").html(e.html_button),$(".group_btn_popup_prd").length>0&&$(".group_btn_popup_prd").html(e.html_button_buynow);[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e)});$(".left").fadeOut(300,function(){$(this).html(e.html).fadeIn(300),isLoading=!1,setTimeout(()=>{$(".main-carousel").owlCarousel({loop:!1,margin:10,nav:!1,items:1,autoplay:!0,slideSpeed:300,animateOut:"animate__fadeOutDown",animateIn:"animate__fadeInDown"})},200);var t=$(".main-carousel");t.on("changed.owl.carousel",function(e){let t=e.item.index-2;$(".nav-item").removeClass("active"),$(`.nav-item[data-position=${t}]`).addClass("active")}),Fancybox.bind('[data-fancybox="gallery"]',{Thumbs:{type:"classic"}}),$(".nav-item").click(function(){let e=$(this).data("position");t.trigger("to.owl.carousel",[e,1e3]),$(".nav-item").removeClass("active"),$(this).addClass("active")}),$(".nav-item").hover(function(){t.trigger("stop.owl.autoplay")})})}},500)},error:function(e,t,o){console.error("An error occurred: "+o)}})}))}function openSidebarVoucher(){$(".openVoucher").on("click",openNavVoucher),$("#closeSidebarVoucher").on("click",closeNavVoucher),$(".backdrop").on("click",function(e){$(e.target).closest(".sidebar_cart, .openVoucher").length||closeNavVoucher()})}function openSidebarCart(){$(".openSidebar").on("click",openNav),$("#closeSidebar").on("click",closeNav),$(".backdrop").on("click",function(e){$(e.target).closest(".sidebar_cart, .openSidebar").length||closeNav()})}function applyInputVoucher(){$(".btn-input-apply-voucher").on("click",function(){let e=$(".input_apply_voucher").val();$.ajax({url:"/apply-voucher",type:"POST",data:{voucher:e},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){200==e.status?($(".code-voucher").text(e.data.code),$(".voucher-discount").text(e.data.voucher),closeNavVoucher(),$(".input_apply_btn").addClass("d-none"),$(".voucher-apply").removeClass("d-none"),$(".alert-message-voucher").text("")):$(".alert-message-voucher").text(e.message)}})})}function showPasswordToggle(){$("#show-password-toggle").on("change",function(){var e=$(this).is(":checked"),t=$("#password-register");e?t.attr("type","text"):t.attr("type","password")})}function resetFormRegister(){$("#modalToggle").on("hidden.bs.modal",function(e){$("#name-register").val(""),$("#email-register").val(""),$("#phone-register").val(""),$("#dob-register").val("")})}function openNav(){$("#mySidebar").css("transform","translateX(0%)"),$(".main-menu-header-mobile").css("left","-1000px"),$("body").css("overflow","auto"),showBackdrop()}function openNavVoucher(){$("#mySidebarVoucher").css("transform","translateX(0%)"),$(".main-menu-header-mobile-voucher").css("left","-1000px"),$("body").css("overflow","auto"),showBackdropVoucher()}function closeNav(){$("#mySidebar").css("transform","translateX(100%)"),hideBackdrop()}function closeNavVoucher(){$("#mySidebarVoucher").css("transform","translateX(100%)")}function change_cart(){$(".show-cart").on("click",function(){openNav(),$(".cart-box").hide()}),$(document).on("change",".color_select",function(){$(".sidebar-content").html(shimmer());$(this),$(this).data("stt");let e=$(this).val(),t=$(this).find("option:selected").data("code"),o=$('meta[name="csrf-token"]').attr("content"),n=$(this).data("hash"),a={color:{label:e,value:t}};$.ajax({url:"/update-cart",type:"POST",dataType:"json",data:{hash:n,options:a,_token:o},success:function(e){$(".sidebar-content").html(e.html),0===e.quantity&&(location.href="/")},error:function(e,t,o){console.error(o),alert("Có lỗi xảy ra khi thêm sản phẩm vào giỏ hàng")}})}),$(document).on("change",".size_select",function(){$(".sidebar-content").html(shimmer());$(this),$(this).data("stt");let e=$(this).val(),t=$('meta[name="csrf-token"]').attr("content"),o=$(this).data("hash"),n={size:{label:e,value:e}};$.ajax({url:"/update-cart",type:"POST",dataType:"json",data:{hash:o,options:n,_token:t},success:function(e){e.message;$(".sidebar-content").html(e.html),0===e.quantity&&location.reload()},error:function(e,t,o){console.error(o),alert("Có lỗi xảy ra khi thêm sản phẩm vào giỏ hàng")}})}),$(document).on("click",".remove-cart-item",function(){$(".sidebar-content").html(shimmer());$(this);let e=$(this).data("hash"),t=$('meta[name="csrf-token"]').attr("content");$.ajax({url:"/remove-cart-item",type:"POST",dataType:"json",data:{hash:e,_token:t},success:function(e){console.log(e.quantity),0===e.quantity&&location.reload(),$(".sidebar-content").html(e.html)},error:function(e,t,o){console.error(o),alert("Có lỗi xảy ra khi thêm sản phẩm vào giỏ hàng")}})}),$(document).on("keyup change",".change-quantity-cart",debounce(function(){$(".sidebar-content").html(shimmer());$(this);let e=$(this).data("hash"),t=$('meta[name="csrf-token"]').attr("content"),o=$(this).val(),n=$(this).closest(".prd_parameter").find(".size_select").val(),a=$(this).closest(".prd_parameter").find(".color_select").val(),r=$(this).closest(".prd_parameter").find(".color_select :selected").data("code"),s=$(this).closest(".prd_parameter").find(".color_select :selected").data("fcolor"),c={size:{label:n,value:$(this).closest(".prd_parameter").find(".size_select :selected").data("fsize")},color:{label:a,value:r,fcolor:s}};$.ajax({url:"/update-cart",type:"POST",dataType:"json",data:{hash:e,quantity:o,options:c,_token:t},success:function(e){$(".sidebar-content").html(e.html),$(".quantity-cart").text(e.quantity),0===e.quantity&&location.reload(),$(".total-pay").length>0&&$(".total-pay").text(e.total),$(".sumAmount-pay").length>0&&$(".sumAmount-pay").text(e.sumAmount),$(".subTotal-pay").length>0&&$(".subTotal-pay").text(e.total)},error:function(e,t,o){console.error(o),alert("Có lỗi xảy ra khi thêm sản phẩm vào giỏ hàng")}})},300)),$("#modalToggle").on("hidden.bs.modal",function(e){$(".modal_login").removeClass("d-none"),$(".modal_register").addClass("d-none"),$(".step-1").addClass("d-none"),$(".step-2").addClass("d-none"),$(".step-3").addClass("d-none")}),$(".register-btn").on("click",function(){$(".modal_register").removeClass("d-none"),$(".step-1").removeClass("d-none"),$(".modal_login").addClass("d-none")});let e="";$(".register-btn-step1").on("click",function(){if(e=$("input[name='email-phone-register'").val(),console.log(validate_register()),!validate_register())return!1;$(".step-1").addClass("d-none"),$(".step-2").removeClass("d-none"),$.ajax({url:"/send-code",type:"POST",data:{email:e,type:"register"},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){"success"===e.status||Swal.fire({position:"top",icon:"error",text:e.message,showConfirmButton:!1,timer:1500})},error:function(e){alert("An error occurred: "+e.responseText)}})}),input_code(),input_code_forgot(),$(".register-btn-step2").on("click",function(){6==$("#otp").val().length&&verifyOTP()}),$(".register-btn-step3").on("click",function(t){register(e)}),$("input[name='email-phone-register']").on("input",debounce(checkEmail,500)),openMenuMobile(),closeMenuMobile(),subMenuMobile(),click_search_header()}let email_forgot;function forgot_password(){$(".forget-password").click(function(){$(".modal_login, .model_register").addClass("d-none"),$(".modal-forgot-password").removeClass("d-none"),$(".forgot-step-1").removeClass("d-none")}),$(".forgot-password-btn-step1").click(function(){if(!validate_forgot())return!1;email_forgot=$("#email-forgot").val(),$(".forgot-password-btn-step1").text("Đang xử lý. Vui lòng chờ..."),$(".forgot-password-btn-step1").css("pointer-events","none"),$.ajax({url:"/send-code",type:"POST",data:{email:email_forgot,type:"forgot-password"},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){"success"===e.status?($(".forgot-step-1").addClass("d-none"),$(".forgot-step-2").removeClass("d-none")):Swal.fire({position:"top",icon:"error",text:e.message,showConfirmButton:!1,timer:1500}),$(".forgot-password-btn-step1").text("Tiếp tục"),$(".forgot-password-btn-step1").css("pointer-events","auto")},error:function(e){alert("An error occurred: "+e.responseText)}})}),$(".forgot-btn-step2").click(function(){6==$("#otp-forgot").val().length&&verifyOTPForgot()}),$("#password-forgot").on("input",function(){var e=$(this).val();console.log(e),evaluatePasswordCriteriaForgot(e)}),$(".forgot-btn-step3").click(function(){validate_change_pass()&&$.ajax({url:"/change-password",type:"POST",data:{email:email_forgot,new_password:$("#password-forgot").val()},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){e.success?($(".forgot-step-3").addClass("d-none"),$(".forgot-step-4").removeClass("d-none")):Swal.fire({position:"top",icon:"success",text:e.message,showConfirmButton:!1,timer:1500})},error:function(e,t,o){console.error("Đã xảy ra lỗi khi đăng ký:",o)}})})}function validate_change_pass(){return!!notEmpty("password-forgot","Bạn chưa nhập mật khẩu mới")&&(!!notEmpty("confirm-password-forgot","Nhập lại mật khẩu không được để trống")&&($("#password-forgot").val()===$("#confirm-password-forgot").val()||(invalid("confirm-password-forgot","Mật khẩu nhập lại không trùng khớp"),fasle)))}function closeMenuMobile(){$(".close-menu-mobile").on("click",function(){$("body").css("overflow","auto"),$(".main-menu-header-mobile").css("left","-1000px")})}function openMenuMobile(){$(".open-menu-btn").on("click",function(){$("body").css("overflow","hidden"),$(".main-menu-header-mobile").css("left","0")})}function subMenuMobile(){$(".main-menu.level-2").prev("a").css({"background-color":"#f5f5f5",padding:"8px"}),$(".back-menu-level-1").on("click",function(){$(".main-menu-header-mobile-level-1").css("left","-1000px")}),$(".main-menu .child-indicator").on("click",function(){$("#navMenuContent").html(""),$(".title-menu-level-0").text($(this).parent().children("a").text());var e=$(this).parent().find(".menu-wrapper").html();$("#navMenuContent").html(e),$(".main-menu-header-mobile-level-1").css("left","0px")}),$(window).click(function(e){var t=$("#navMenu");$(e.target).closest("li").length||$(e.target).closest(t).length||t.css("width","0")})}function checkEmail(){let e=$("input[name='email-phone-register']").val();$.ajax({url:"/check-mail",method:"post",data:{email:e},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){"success"!==e.status?($(".label_error_email").text(e.message.email),$(".label_error_email").show()):($(".label_error_email").text(""),$(".label_error_email").hide())}})}function register(e){$(".modal_login").removeClass("d-none"),$(".modal_register").addClass("d-none"),$(".step-1").addClass("d-none"),$(".step-2").addClass("d-none"),$(".step-3").addClass("d-none"),$.ajax({url:"/register",type:"POST",data:{email:e,password:$("#password-register").val(),name:$("#name-register").val(),phone:$("#phone-register").val(),dob:$("#dob-register").val()},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){Swal.fire({position:"top",icon:"success",text:e.message,showConfirmButton:!1,timer:1500})},error:function(e,t,o){console.error("Đã xảy ra lỗi khi đăng ký:",o)}})}function evaluatePasswordCriteria(e){var t={lowerCase:/[a-z]/.test(e),upperCase:/[A-Z]/.test(e),length:e.length>=8&&e.length<=16,characters:/^[a-zA-Z0-9]+$/.test(e)};for(var o in t)t[o]?$("."+o).css("color","green"):$("."+o).css("color","red")}function evaluatePasswordCriteriaForgot(e){var t={"lowerCase-forgot":/[a-z]/.test(e),"upperCase-forgot":/[A-Z]/.test(e),"length-forgot":e.length>=8&&e.length<=16,"characters-forgot":/^[a-zA-Z0-9]+$/.test(e)};for(var o in t)t[o]?$("#"+o).css("color","green"):$("#"+o).css("color","red")}function verifyOTP(e){$.ajax({url:"/verify-otp",type:"POST",data:{otp:$("#otp").val()},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){e.success?($(".step-1").addClass("d-none"),$(".step-2").addClass("d-none"),$(".step-3").removeClass("d-none"),$(".label_error").hide()):($(".label_error").text(e.message),$(".label_error").show())},error:function(e,t,o){console.error("Error while verifying OTP: "+o)}})}function verifyOTPForgot(e){$.ajax({url:"/verify-otp",type:"POST",data:{otp:$("#otp-forgot").val()},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){e.success?($(".forgot-step-1").addClass("d-none"),$(".forgot-step-2").addClass("d-none"),$(".forgot-step-3").removeClass("d-none"),$(".label_error").hide()):($(".label_error").text(e.message),$(".label_error").show())},error:function(e,t,o){console.error("Error while verifying OTP: "+o)}})}function input_code(){(e=>{let t=[];function o(e){const t=e.nextElementSibling;null!==t&&t.focus()}function n(e){const t=e.previousElementSibling;null!==t&&t.focus()}function a(e){return e>=48&&e<=57||e>=96&&e<=105}const r=document.createElement("div");r.classList.add("otpCode");for(let s=0;s<e.maxLength;s++){const c=document.createElement("input");c.classList.add("otpCode__digit"),c.type="tel",c.pattern=e.pattern,c.maxLength=1,c.required=!0,c.addEventListener("keypress",e=>{a(e.keyCode)||e.preventDefault()}),c.addEventListener("keyup",n=>{if(a(n.keyCode)){const e=n.keyCode>=96&&n.keyCode<=105?n.keyCode-48:n.keyCode;n.currentTarget.value=String.fromCharCode(e),o(n.currentTarget)}t[s]=n.currentTarget.value,e.value=t.join("")}),c.addEventListener("keydown",e=>{switch(e.keyCode){case 8:""===(t=e.currentTarget).value?n(t):t.value="";break;case 37:n(e.currentTarget);break;case 39:o(e.currentTarget);break;default:return}var t}),r.appendChild(c)}e.parentNode.insertBefore(r,e)})(document.querySelector("[data-controller=oneTimeCode]"))}function input_code_forgot(){(e=>{let t=[];function o(e){const t=e.nextElementSibling;null!==t&&t.focus()}function n(e){const t=e.previousElementSibling;null!==t&&t.focus()}function a(e){return e>=48&&e<=57||e>=96&&e<=105}const r=document.createElement("div");r.classList.add("otpCode");for(let s=0;s<e.maxLength;s++){const c=document.createElement("input");c.classList.add("otpCode__digit"),c.type="tel",c.pattern=e.pattern,c.maxLength=1,c.required=!0,c.addEventListener("keypress",e=>{a(e.keyCode)||e.preventDefault()}),c.addEventListener("keyup",n=>{if(a(n.keyCode)){const e=n.keyCode>=96&&n.keyCode<=105?n.keyCode-48:n.keyCode;n.currentTarget.value=String.fromCharCode(e),o(n.currentTarget)}t[s]=n.currentTarget.value,e.value=t.join("")}),c.addEventListener("keydown",e=>{switch(e.keyCode){case 8:""===(t=e.currentTarget).value?n(t):t.value="";break;case 37:n(e.currentTarget);break;case 39:o(e.currentTarget);break;default:return}var t}),r.appendChild(c)}e.parentNode.insertBefore(r,e)})(document.querySelector("[data-controller=oneTimeCodeForgot]"))}function click_search_header(){$("#searchIcon").click(function(){var e=$("#searchForm");"none"===e.css("display")?e.css("display","block").animate({opacity:1,transform:"scale(1)"},500,function(){e.addClass("show")}):e.animate({opacity:0,transform:"scale(0.9)"},500,function(){e.css("display","none").removeClass("show")})})}function mouse_hover_menu(){let e=get_hot_categories();$(".main-menu .evel-0").on("mouseover",function(){$("#expand-content .wrapper").html("");var t=$(this).find(".expand").html();if(null==t)return $(".image-category-hot").html(""),void $("#expand-content").css("padding","0px");$("#expand-content .wrapper").html(t),void 0!==t?$("#expand-content").css("padding","10px 0px"):$("#expand-content").css("padding","0px");let o=$(this).find(".title-menu-0").text(),n="";Object.keys(e).forEach(t=>{o.toLowerCase()===t.toLowerCase()&&e[t].forEach((e,t)=>{t<2&&""!==e.image&&(n+=`<a href="${e.href}" class="image-level-1 ms-3">\n                                        <img src="${e.image}" />\n                                        <div class="mt-2 fw-bold">${e.text}\n                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 16 16">\n                                            <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708"/>\n                                        </svg>\n                                        </div>\n                                    </a>`)})}),$(".image-category-hot").html(n)});var t=!1;$(".close-main-menu").mouseleave(function(e){$("#expand-content .wrapper").html(""),$(".image-category-hot").html(""),$("#expand-content").css("padding","0px"),t=!1}),$("#expand-content").mouseleave(function(e){t||($("#expand-content .wrapper").html(""),$(".image-category-hot").html(""),$("#expand-content").css("padding","0px"))})}function get_hot_categories(){const e=document.getElementById("hot_images").value;return groupByParentRoot(JSON.parse(e))}function groupByParentRoot(e){const t={};for(const o of e){const e=o.parent_root;t[e]||(t[e]=[]),t[e].push({image:o.image,text:o.parent_text,href:o.parent_href})}return t}function debounce(e,t){let o;return function(){const n=this,a=arguments;clearTimeout(o),o=setTimeout(()=>e.apply(n,a),t)}}function format_price(e){return e.replace(/[.\s₫]/g,"")}function showBackdrop(){$(".backdrop").css({opacity:1}).css("pointer-events","initial")}function showBackdropVoucher(){$(".backdropVoucher").css({opacity:1}).css("pointer-events","initial")}function hideBackdrop(){$(".backdrop").css({opacity:0}).css("pointer-events","none")}function hideBackdropVoucher(){$(".backdropVoucher").css({opacity:0}).css("pointer-events","none")}function validate_register(){return!!notEmpty("name-register","Vui lòng nhập tên của bạn")&&(!!notEmpty("email-register","Vui lòng nhập email của bạn")&&(!!notEmpty("phone-register","Vui lòng nhập số điện thoại")&&!!notEmpty("dob-register","Vui lòng chọn ngày sinh nhật")))}function validate_forgot(){return!!notEmpty("email-forgot","Vui lòng nhập email của bạn")}function shimmer(){return'\n<div class="example">\n  <div class="avatar shimmer"></div>\n  <div class="floatLeft">\n    <div class="line shimmer"></div>\n    <div class="line shimmer"></div>\n    <div class="line line--trunc shimmer"></div>\n  </div>\n</div>\n    '}
